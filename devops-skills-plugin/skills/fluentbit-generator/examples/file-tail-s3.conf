# Fluent Bit Configuration: File Tailing to S3
# This configuration tails log files and archives them to Amazon S3.

[SERVICE]
    Flush         5
    Log_Level     info
    Daemon        Off
    HTTP_Server   On
    HTTP_Port     2020

[INPUT]
    Name              tail
    Tag               files.application
    Path              /var/log/app/*.log
    DB                /var/log/flb_files.db
    Mem_Buf_Limit     100MB
    Skip_Long_Lines   On
    Refresh_Interval  10

[FILTER]
    Name          modify
    Match         *
    Add           source file-collector
    Add           host ${HOSTNAME}

[FILTER]
    Name          parser
    Match         *
    Key_Name      log
    Parser        json
    Reserve_Data  On

[OUTPUT]
    Name              s3
    Match             *
    bucket            my-logs-archive-bucket
    region            us-east-1
    total_file_size   100M
    upload_timeout    10m
    use_put_object    Off
    compression       gzip
    # S3 key format with time-based partitioning
    s3_key_format     /logs/app/%Y/%m/%d/%H-%M-%S-$UUID.gz
    Retry_Limit       3
    # IAM role authentication (no hardcoded credentials)
    # Credentials loaded from environment or IAM role