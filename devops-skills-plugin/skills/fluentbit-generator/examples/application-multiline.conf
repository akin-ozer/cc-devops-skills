# Fluent Bit Configuration: Application Logs with Multi-line Parsing
# This configuration tails application logs with multi-line support for stack traces
# and forwards to Elasticsearch.

[SERVICE]
    Flush         1
    Log_Level     info
    Daemon        Off
    HTTP_Server   On
    HTTP_Port     2020
    Parsers_File  parsers.conf

[INPUT]
    Name              tail
    Tag               app.myapp
    Path              /var/log/app/*.log
    Parser            json
    Multiline.Parser  multiline-java
    DB                /var/log/flb_app.db
    Mem_Buf_Limit     100MB
    Skip_Long_Lines   On
    Read_from_Head    Off

[FILTER]
    Name          modify
    Match         *
    Add           app_name myapp
    Add           environment production
    Add           version 1.0.0

[FILTER]
    Name          parser
    Match         *
    Key_Name      log
    Parser        json
    Reserve_Data  On
    Preserve_Key  Off

[FILTER]
    Name          grep
    Match         *
    # Only forward ERROR and above
    Regex         level (ERROR|FATAL|CRITICAL)

[OUTPUT]
    Name              es
    Match             *
    Host              elasticsearch
    Port              9200
    Index             app-logs
    Retry_Limit       3
    storage.total_limit_size 10M
    tls               On
    tls.verify        Off