# Fluent Bit Configuration: HTTP Webhook to Kafka
# This configuration receives logs via HTTP webhook and forwards them to Kafka.

[SERVICE]
    Flush         1
    Log_Level     info
    Daemon        Off
    HTTP_Server   On
    HTTP_Port     2020

[INPUT]
    Name          http
    Tag           webhook.events
    Listen        0.0.0.0
    Port          9880
    Buffer_Size   32KB

[FILTER]
    Name          modify
    Match         *
    Add           source webhook
    Add           collector fluent-bit
    Add           timestamp ${TIME}

[FILTER]
    Name          parser
    Match         *
    Key_Name      log
    Parser        json
    Reserve_Data  On

[OUTPUT]
    Name              kafka
    Match             *
    Brokers           kafka-broker-1:9092,kafka-broker-2:9092,kafka-broker-3:9092
    Topics            application-logs
    Format            json
    Timestamp_Key     @timestamp
    Retry_Limit       3
    # Kafka producer configuration
    rdkafka.queue.buffering.max.messages     100000
    rdkafka.request.required.acks            1
    rdkafka.message.send.max.retries         3
    rdkafka.compression.type                 gzip